//- views/workbench.pug
extends player_shell

block content
  .content-scroll(data-page="workbench")
    .workbench-container
      //- ========== COLUMN 1: DIGGING (Search) ==========
      section.workbench-panel.digging-panel
        .panel-header
          h2 
            i.fas.fa-search(style="margin-right: 8px")
            | Digging
          .cue-status.idle#cueStatus ðŸŽ§ Cue ready
        
        .search-mini
          i.fas.fa-search
          input#digSearch(
            type="text" 
            placeholder="Search local artists, tracks..." 
            onkeyup="if(window.workbench) workbench.searchTracks(this.value)"
            autocomplete="off"
          )
        
        .results-list#digResults
          .search-empty
            i.fas.fa-record-vinyl
            p Start digging!
            span.search-hint Type at least 2 characters to search

      //- ========== COLUMN 2: THE STACK (Active Crate) ==========
      section.workbench-panel.stack-panel
        .panel-header
          .crate-header-controls
            //- Draft Status Indicator
            .draft-status#draftStatus(style="display: none")
              i.fas.fa-save
              span Draft saved
            
            //- Load Existing Crate Dropdown
            .crate-loader
              button.btn-load-crate(onclick="if(window.workbench) workbench.toggleCrateMenu()")
                i.fas.fa-folder-open
                span Load
              .crate-menu#crateLoadMenu
                .crate-menu-header
                  span Your Crates
                  button.close-menu(onclick="if(window.workbench) workbench.toggleCrateMenu()")
                    i.fas.fa-times
                
                //- Draft option at top
                #draftOption.crate-menu-draft(onclick="if(window.workbench) workbench.loadDraft()" style="display: none")
                  .draft-banner
                    i.fas.fa-file-alt
                    .draft-info
                      .draft-title Unsaved Draft
                      .draft-meta Continue where you left off
                
                .crate-menu-divider(style="margin: 8px 0; border-top: 1px solid var(--border-color)")
                
                .crate-menu-list#userCratesList
                  .loading-crates
                    i.fas.fa-spinner.fa-spin
                    span Loading your crates...
          
          .stack-controls
            //- New Crate Button
            button.btn-new-crate(onclick="if(window.workbench) workbench.newCrate()" title="New Crate")
              i.fas.fa-plus
            
            //- Clear Button
            button.btn-clear-crate(onclick="if(window.workbench) workbench.clearStack()" title="Clear all tracks")
              i.fas.fa-trash-alt
            
            //- Save Button
            button.btn-save-crate#saveCrateBtn(onclick="if(window.workbench) workbench.saveCrate()")
              i.fas.fa-save
              span Save
        
        //- IMPROVED: Dedicated Title Section Above Workbench
        .crate-title-section
          .title-label
            i.fas.fa-edit
            span Crate Title
          input.crate-title-input#crateTitleInput(
            type="text" 
            placeholder="Untitled Crate" 
            maxlength="50"
          )
        
        .crate-workbench-area#crateWorkbench(
          ondragover="if(window.workbench) workbench.handleDragOver(event)" 
          ondrop="if(window.workbench) workbench.handleDrop(event)"
        )
          .empty-workbench-state
            i.fas.fa-layer-group
            p Drag songs here to build your stack
            span.empty-hint Tip: Hold and drag to reorder tracks

      //- ========== COLUMN 3: CRATE COVER & DNA ==========
      section.workbench-panel.analytics-panel
        .panel-header
          h3 
            i.fas.fa-image(style="margin-right: 8px")
            | Crate Cover
        
        //- Cover Art Upload Section
        .crate-cover-section
          .cover-preview#coverPreview
            .cover-placeholder
              i.fas.fa-box-open
              p No cover yet
              span.cover-hint Click to upload
          
          input#coverUploadInput(
            type="file" 
            accept="image/*" 
            style="display: none"
            onchange="if(window.workbench) workbench.handleCoverUpload(event)"
          )
          
          .cover-actions
            button.btn-upload-cover(onclick="document.getElementById('coverUploadInput').click()")
              i.fas.fa-upload
              span Upload Cover
            
            button.btn-remove-cover#removeCoverBtn(
              onclick="if(window.workbench) workbench.removeCover()"
              style="display: none"
            )
              i.fas.fa-trash
              span Remove
        
        //- DNA Stats Section
        .panel-header(style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 20px")
          h3 
            i.fas.fa-dna(style="margin-right: 8px")
            | Crate DNA
        
        .dna-stats
          .stat-box
            span.stat-label Track Count
            span.stat-value#trackCount 0
          
          .stat-box
            span.stat-label Total Time
            span.stat-value#totalDuration 0:00
          
          .stat-box
            span.stat-label Energy Flow
            .stat-bar-container
              .stat-bar#energyBar(style="width: 0%")
          
          .stat-box
            span.stat-label Avg BPM
            span.stat-value#avgBpm --
        
        .genre-tags-cloud#crateTags
          span.tag-placeholder No genres yet
