doctype html
html
  head
    title Eporia Player
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    link(rel='stylesheet', href='https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap')
    link(rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css")
    link(rel='stylesheet' href='/stylesheets/playerStyle.css')
    link(rel='stylesheet' href='/stylesheets/profile.css')
    link(rel='stylesheet' href='/stylesheets/artistProfile.css')

  body
    //- --- LEFT SIDEBAR (Unchanged) ---
    .sidebar.left-sidebar.desktop-only
      .brand EPORIA
      .nav-group
        .nav-label MENU
        .nav-item.active(onclick="navigateTo('/player/dashboard')"): span Home
        .nav-item(onclick="navigateTo('/player/explore')"): span Explore
        .nav-item(onclick="navigateTo('/player/local')"): span Local Scene
      
      .nav-group
        .nav-label YOUR ARTISTS
        #sidebarArtistList
          //- Populated by JS
          .artist-item.skeleton-text(style="width: 70%; opacity: 0.3")

    //- --- MAIN CONTENT (The New Dashboard) ---
    .main-wrapper
      .mobile-header
        .mobile-greeting Good Morning
        img.profile-pic-mobile(src="https://via.placeholder.com/50")

      .content-scroll(data-page="dashboard")
        //- 1. HERO: MOOD SELECTOR
        .dashboard-hero
          h1(style="margin-bottom: 20px; font-size: 2rem; font-weight: 900") What's the vibe?
          
          //- Tabs
          .mood-tabs
            button.mood-tab.active(onclick="filterMoods('all')") All
            button.mood-tab(onclick="filterMoods('energy')") Energy
            button.mood-tab(onclick="filterMoods('activity')") Doing
            button.mood-tab(onclick="filterMoods('emotion')") Feeling

          //- Grid (Populated by JS)
          .mood-grid-hero#moodGrid
            //- Skeletons for initial load
            .mood-card.skeleton-box
            .mood-card.skeleton-box
            .mood-card.skeleton-box
            .mood-card.skeleton-box

        //- 2. JUMP BACK IN
        section.feed-section
          .section-header
            h3 Jump Back In
            button.btn-text See All
          
          .scroll-row
            
            //- "Coming Soon" Placeholder
            .media-card.placeholder
              .img-container.dashed
                i.fas.fa-history(style="font-size: 2rem; color: var(--text-muted); opacity: 0.5")
              .card-info
                .card-title Keep Listening
                .card-subtitle History fills up here

        //- 3. NEW RELEASES
        section.feed-section
          .section-header
            h3 New From Your Artists
            //- Optional: You can make this badge dynamic later
            span.badge-new(style="background:var(--accent-orange); color:white; padding:2px 8px; border-radius:10px; font-size:0.7rem; font-weight:800") Fresh
          
          //- [CHANGE] Added ID here
          .scroll-row#newReleasesContainer
            //- Skeletons (Will be replaced by JS)
            .media-card.skeleton-box(style="min-width:160px; height:200px")
            .media-card.skeleton-box(style="min-width:160px; height:200px")
            .media-card.skeleton-box(style="min-width:160px; height:200px")
            
            //- Action Card
            .media-card.action-card(onclick="navigateTo('/player/explore')")
              .img-container(style="background: rgba(0,0,0,0.03); display: flex; align-items: center; justify-content: center")
                i.fas.fa-plus(style="color: var(--text-muted)")
              .card-info
                .card-title Follow More
                .card-subtitle To see new drops

        //- 4. COMMUNITY (Friends)
        section.feed-section
          .section-header
            h3 Friends are Listening To
          
          .scroll-row
            //- Action Card
            .media-card.action-card(onclick="navigateTo('/player/explore')")
              .img-container(style="background: rgba(0,0,0,0.03); display: flex; align-items: center; justify-content: center")
                i.fas.fa-plus(style="color: var(--text-muted)")
              .card-info
                .card-title Follow More
                .card-subtitle To see new drops
        //- 5. ALGO RECOMMENDATIONS
        section.feed-section
          h3(style="margin-bottom: 15px") Because you listen to <span style="color:var(--primary)">Indie Pop</span>
          .artist-circle-row(style="display:flex; gap: 20px")
             .artist-circle(onclick="navigateTo('/artist/a1')" style="text-align:center; cursor:pointer")
               img(src="https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?w=200" style="width:120px; height:120px; border-radius:50%; margin-bottom:10px; object-fit:cover")
               div(style="font-weight:700; font-size:0.9rem") The Mar√≠as
             .artist-circle(onclick="navigateTo('/artist/a2')" style="text-align:center; cursor:pointer")
               img(src="https://images.unsplash.com/photo-1520333789090-1afc82db536a?w=200" style="width:120px; height:120px; border-radius:50%; margin-bottom:10px; object-fit:cover")
               div(style="font-weight:700; font-size:0.9rem") Clairo

        //- 6. LOCAL SCENE (The "Blank Image" Request)
        section.feed-section
          .section-header
            h3 <i class="fas fa-map-marker-alt" style="color:var(--accent-orange)"></i> Trending in San Diego
          
          .scroll-row
            //- Playlist 1: Blank Gradient
            .media-card(onclick="navigateTo('/playlist/view/local_sd_indie')")
              .img-container.gradient-placeholder(style="background: linear-gradient(135deg, #88C9A1, #4facfe); display:flex; align-items:center; justify-content:center; color:white; font-weight:900; font-size:1.5rem")
                span SD
              .card-info
                .card-title North Park Indie
                .card-subtitle Local Gems
            
            //- Playlist 2: Blank Gradient
            .media-card(onclick="navigateTo('/playlist/view/local_sd_house')")
              .img-container.gradient-placeholder(style="background: linear-gradient(45deg, #FF9A9E, #FECFEF); display:flex; align-items:center; justify-content:center; color:white; font-weight:900; font-size:1.5rem")
                span PB
              .card-info
                .card-title PB House Party
                .card-subtitle Beach Vibes

        //- Spacing for Bottom Player
        div(style="height: 120px")

    //- --- RIGHT SIDEBAR (Unchanged) ---
    .right-sidebar.desktop-only.minimized#rightSidebar
      .sidebar-tools
        .search-container
          //- [NEW] PREFIX SELECTOR
          .search-prefix#searchPrefixBtn(onclick="toggleSearchFilter()")
            i.fas.fa-search#currentSearchIcon
            i.fas.fa-chevron-down(style="font-size:0.6rem; margin-left:5px")
          
          //- THE DROPDOWN MENU
          .search-filter-menu#searchFilterMenu
            .filter-item(onclick="setSearchMode('general')") 
                i.fas.fa-search 
                span All
            .filter-item(onclick="setSearchMode('artist')") 
                i.fas.fa-microphone-alt 
                span Artists (@)
            .filter-item(onclick="setSearchMode('song')") 
                i.fas.fa-music 
                span Songs (s:)
            .filter-item(onclick="setSearchMode('user')") 
                i.fas.fa-user 
                span Users (u:)
            .filter-item(onclick="setSearchMode('city')") 
                i.fas.fa-city 
                span Cities (C:)

          input#mainSearchInput(type="text" placeholder="Search..." autocomplete="off")
          
          //- [NEW] RESULTS DROPDOWN
          .search-results-dropdown#searchResults
            //- Populated by JS
            .search-placeholder Start typing to find music...
        
        .profile-menu-container
          .profile-trigger(onclick="toggleProfileMenu()")
            span.username#profileName Loading...
            img.profile-pic#profilePic(src="https://via.placeholder.com/50")
            i.fas.fa-chevron-down.profile-chevron
          
          .dropdown-menu#profileDropdown
            .wallet-section
                .wallet-header
                   span.wallet-label Fair Trade Balance
                   i.fas.fa-info-circle
                .wallet-balance-row
                   span.currency $
                   span.amount#userWalletBalance --.--
                .wallet-progress
                    .wallet-bar#walletBar(style="width: 100%")

            .dropdown-divider
            .dropdown-item(onclick="navigateTo('/player/profile')")
              i.fas.fa-user
              span Edit Profile
              //- [NEW] DARK MODE TOGGLE
            .dropdown-divider
            .dropdown-item(onclick="toggleTheme(); event.stopPropagation()")
              div(style="display:flex; align-items:center")
                 i.fas.fa-moon
                 span(style="margin-left: 10px") Dark Mode
              .theme-switch
                .switch-knob
            .dropdown-item(onclick="navigateTo('/player/settings')")
              i.fas.fa-cog
              span Settings
            .dropdown-divider
            .dropdown-item.danger(onclick="window.location.href='/members/logout'")
              i.fas.fa-sign-out-alt
              span Sign Out

      //- FULL PLAYER (Styled & Functional)
      .player-full
        //- 1. BACKGROUND ART (Starts Empty, JS adds style)
        .art-container
          div#d-art-full.full-album-art
        
        //- 2. GRADIENT OVERLAY
        .player-overlay

        //- 3. TOP SECTION
        .player-top-section
          .header-text-block
            //- Placeholder text that matches your CSS classes
            h2#d-title-full.song-title-hero Ready to Play
            p#d-artist-full.song-artist-hero Select a track
          
          button.minimize-btn(onclick="togglePlayerSize()")
            i.fas.fa-chevron-down
        
        //- 4. BOTTOM SECTION
        .player-bottom-section
          
          //- Floating Actions
          .floating-actions-row
            button.heart-btn-hero(onclick="toggleHeart()"): i.far.fa-heart
            button.tip-pill-hero(onclick="alert('Tip sent!')") 
              span Tip Artist
              i.fas.fa-coins
          
          //- Progress
          .hero-progress-container
            .progress-track(onclick="seek(event)"): .progress-fill#progressBar
            .time-labels
              span#currentTime 0:00
              span#totalTime -:--

          //- Controls
          .hero-controls-row
            button.btn-nav-hero(onclick="sendCmd('prev')"): i.fas.fa-step-backward
            button.btn-play-hero(onclick="togglePlay()"): i.fas.fa-play
            button.btn-nav-hero(onclick="sendCmd('next')"): i.fas.fa-step-forward

      //- MINI PLAYER (Styled & Functional)
      .player-mini(onclick="togglePlayerSize()")
        .mini-left
          //- Art placeholder class handles the empty grey box
          div#d-art-mini.mini-album-art.art-placeholder
          .mini-info
            span#d-title-mini.mini-title Ready
            span#d-artist-mini.mini-artist Select track
        .mini-controls
          button.btn-play-mini(onclick="togglePlay(); event.stopPropagation()"): i.fas.fa-play
          i.fas.fa-chevron-up.expand-icon

    //- MOBILE ELEMENTS (Unchanged)
    .mini-player-mobile#mobilePlayer
       .mp-left
        img#m-art(src="" style="background:#333")
        .mp-info
          .mp-title#m-title Not Playing
          .mp-artist#m-artist Select a song
       .mp-controls
        button.mp-btn(onclick="toggleHeart()"): i.far.fa-heart
        button.mp-play(onclick="togglePlay()"): i.fas.fa-play

    .bottom-nav-mobile
      .b-nav-item.active: i.fas.fa-home
      .b-nav-item: i.fas.fa-search
      .b-nav-item: i.fas.fa-book

    script(type="module" src="/javascripts/enhancedPlayer.js")
    script(src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js")

    script(type="module" src="/javascripts/appRouter.js")