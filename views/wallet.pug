//- views/wallet.pug
extends player_shell

block content
  .content-scroll(data-page="wallet")
    
    //- 1. BANKING HERO SECTION
    .wallet-hero
      .wallet-header
        h1 My Wallet
        //- [FIX] Removed hardcoded crown icon here, let JS handle the badge content entirely
        .chip-badge.premium#walletPlanBadge
            span Loading...
      
      //- THE "DIGITAL CARD"
      .balance-card
        .card-bg-art
        .card-top
            span.card-label Available to Allocate
            //- [FIX] Removed WiFi Icon
            .card-chip
        .card-balance
            span.currency $
            span#walletBalanceDisplay 0.00
        .card-bottom
            .card-info-col
                span.label Monthly Allocation
                span.value#walletAllocation $0.00
            .card-logo EPORIA
      
      //- ALLOCATION INTERFACE
      #allocationContainer
        .allocation-container(style="text-align:center; padding:60px")
            i.fas.fa-circle-notch.fa-spin(style="font-size:2rem; color:var(--primary)")
            p(style="margin-top:15px; color:var(--text-secondary)") Loading artists...

    //- 2. TRANSACTION LIST
    section.feed-section(style="max-width: 800px; margin: 0 auto 50px")
      .section-header(style="padding: 0 10px; margin-bottom: 15px")
        h3 Allocation History
      
      .transaction-list#transactionList
        if transactions && transactions.length > 0
          each tx in transactions
            .tx-item(class=tx.type)
              .tx-icon
                i.fas(class=tx.icon)
              .tx-details
                .tx-title #{tx.title} to <strong>#{tx.artistName}</strong>
                //- [NEW] Metadata display for "Inspired by"
                if tx.description
                  p.tx-description(style="font-size: 0.8rem; color: var(--text-secondary); margin: 0;") #{tx.description}
                .tx-date #{tx.date || new Date(tx.timestamp).toLocaleDateString()}
              .tx-amount -$#{tx.amount.toFixed(2)}
        else
          .no-transactions(style="text-align:center; padding: 40px; color: var(--text-secondary);")
            i.fas.fa-history(style="font-size: 2rem; margin-bottom: 10px; opacity: 0.3")
            p No allocations yet. Your impact starts here.