//- views/artist_profile.pug
extends player_shell

block content
  .content-scroll(data-page="artist-profile")
    //- HERO
    .artist-hero-compact(style=`background-image: linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 100%), url('${artist.bannerImage || artist.profileImage || "https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=1200"}')`)
      .hero-content-row
        img.hero-avatar-small(src=artist.profileImage || "https://via.placeholder.com/150") 
        .hero-text-row
          h1 #{artist.name} 
          .meta-row
            if artist.musicProfile && artist.musicProfile.primaryGenre
              span.genre #{artist.musicProfile.primaryGenre} 
            else 
              span.genre Artist
            
            span.dot â€¢
            span.loc #{artist.location || "Global"} 
          
          .action-row
            button.btn-follow-sm#followBtn(
                onclick="toggleFollow(this)"
                data-artist-id=artist.id 
                data-artist-name=artist.name
                data-artist-img=artist.profileImage
            ) Follow
            
            button.btn-tip-sm(onclick="openTipModal()") $ Tip 

    //- TABS
    .profile-tabs
      button.tab-btn.active(onclick="switchArtistTab('music')") Music
      button.tab-btn(onclick="switchArtistTab('merch')") Store
      button.tab-btn(onclick="switchArtistTab('community')") Community

    //- TAB CONTENT: MUSIC
    .tab-content#tab-music
      .bio-summary
        p #{artist.bio || "No bio available yet."} 
        if artist.musicProfile && artist.musicProfile.subgenres
            .tags-row
              each tag in artist.musicProfile.subgenres
                span.tag ##{tag} 

      h3.sub-header Popular Tracks
      .track-list-compact
        if tracks && tracks.length > 0
            each track, index in tracks
                //- Row now just highlights, buttons handle actions
                .track-row
                  span.track-num #{index + 1} 
                  img.track-img(src=track.artUrl) 
                  
                  .track-info-row
                    span.t-title #{track.title} 
                    span.t-plays #{track.plays.toLocaleString()} plays 
                  
                  //- CONTROLS
                  .row-controls(style="display:flex; gap:10px; align-items:center; margin-right:15px")
                      
                      button.row-btn(onclick=`playSong('${track.id}', '${track.title.replace(/'/g, "\\'")}', '${artist.name.replace(/'/g, "\\'")}', '${track.artUrl}', '${track.audioUrl}', '${track.duration}')` title="Play")
                        i.fas.fa-play

                      button.row-btn(onclick=`addToQueue('${track.id}', '${track.title.replace(/'/g, "\\'")}', '${artist.name.replace(/'/g, "\\'")}', '${track.artUrl}', '${track.audioUrl}', '${track.duration}')` title="Add to Queue")
                        i.fas.fa-list

                      //- [FIX] Added data-song-id for JS Hydration
                      button.row-btn(
                        onclick=`toggleSongLike(this, '${track.id}', '${track.title.replace(/'/g, "\\'")}', '${artist.name.replace(/'/g, "\\'")}', '${track.artUrl}', '${track.audioUrl}', '${track.duration}')` 
                        title="Like"
                        data-song-id=track.id
                      )
                        i.far.fa-heart 
                  
                  span.t-time #{formatTime(track.duration)} 
        else
            .empty-state(style="text-align:center; padding: 40px; color: #888")
                p No releases yet. 

    //- TAB CONTENT: PLACEHOLDERS
    .tab-content#tab-merch(style="display: none;")
      h3.sub-header Official Merch
      .empty-state(style="text-align:center; padding: 40px; color: #888")
          p Merch store coming soon. 

    .tab-content#tab-community(style="display: none;")
      h3.sub-header Vibe Check
      .comment-wall
         .comment-bubble
            .comment-user
              img(src="https://via.placeholder.com/50") 
              span @fan_one
            p "Can't wait to see you live!" 

    div(style="height: 120px")