//- views/artist_profile.pug - UPDATED WITH ARTISTID
extends player_shell

block content
  .content-scroll(data-page="artist-profile")
    //- HERO
    .artist-hero-compact(style=`background-image: linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 100%), url('${artist.bannerImage || artist.profileImage || "https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=1200"}')`)
      .hero-content-row
        img.hero-avatar-small(src=artist.profileImage || "https://via.placeholder.com/150") 
        .hero-text-row
          h1 #{artist.name} 
          .meta-row
            if artist.musicProfile && artist.musicProfile.primaryGenre
              span.genre #{artist.musicProfile.primaryGenre} 
            else 
              span.genre Artist
            
            span.dot â€¢
            span.loc #{artist.location || "Global"} 
          
          .action-row
            button.btn-follow-sm#followBtn(
                onclick="toggleFollow(this)"
                data-artist-id=artist.id 
                data-artist-name=artist.name
                data-artist-img=artist.profileImage
            ) Follow
            
            //- UPDATED: Tip button now uses proper artistId (not string interpolation in onclick)
            button.btn-tip-sm(onclick=`window.ui.openTipModal('${artist.id}', '${artist.name.replace(/'/g, "\\'")}')`) 
              i.fas.fa-dollar-sign 
              |  Tip Artist 

    //- TABS
    .profile-tabs
      button.tab-btn.active(onclick="switchArtistTab('music')") Music
      button.tab-btn(onclick="switchArtistTab('merch')") Store
      button.tab-btn(onclick="switchArtistTab('community')") Community

    //- TAB CONTENT: MUSIC
    .tab-content#tab-music
      .bio-summary
        p #{artist.bio || "No bio available yet."} 
        if artist.musicProfile && artist.musicProfile.subgenres
            .tags-row
              each tag in artist.musicProfile.subgenres
                span.tag ##{tag} 

      h3.sub-header Popular Tracks
      .track-list-compact
        if tracks && tracks.length > 0
            each track, index in tracks
                //- UPDATED: All buttons now pass artistId as 7th parameter
                .track-row
                  span.track-num #{index + 1} 
                  img.track-img(src=track.artUrl) 
                  
                  .track-info-row
                    span.t-title #{track.title} 
                    span.t-plays #{track.plays.toLocaleString()} plays 
                  
                  //- CONTROLS - UPDATED with artistId
                  .row-controls(style="display:flex; gap:10px; align-items:center; margin-right:15px")
                      
                      button.row-btn(
                        onclick=`playSong('${track.id}', '${track.title.replace(/'/g, "\\'")}', '${artist.name.replace(/'/g, "\\'")}', '${track.artUrl}', '${track.audioUrl}', '${track.duration}', '${artist.id}')` 
                        title="Play"
                      )
                        i.fas.fa-play

                      button.row-btn(
                        onclick=`addToQueue('${track.id}', '${track.title.replace(/'/g, "\\'")}', '${artist.name.replace(/'/g, "\\'")}', '${track.artUrl}', '${track.audioUrl}', '${track.duration}', '${artist.id}')` 
                        title="Add to Queue"
                      )
                        i.fas.fa-list

                      button.row-btn(
                        onclick=`toggleSongLike(this, '${track.id}', '${track.title.replace(/'/g, "\\'")}', '${artist.name.replace(/'/g, "\\'")}', '${track.artUrl}', '${track.audioUrl}', '${track.duration}')` 
                        title="Like"
                        data-song-id=track.id
                      )
                        i.far.fa-heart 
                  
                  span.t-time #{formatTime(track.duration)} 
        else
            .empty-state(style="text-align:center; padding: 40px; color: #888")
                p No releases yet. 

    //- TAB CONTENT: PLACEHOLDERS
    .tab-content#tab-merch(style="display: none;")
      h3.sub-header Official Merch
      .empty-state(style="text-align:center; padding: 40px; color: #888")
          p Merch store coming soon. 

    //- TAB CONTENT: COMMUNITY WALL (YouTube Style)
    .tab-content#tab-community(style="display: none;")
      section.artist-wall-section
        
        //- 1. Header Row
        .yt-wall-header
            span.yt-count#commentCount 0 Comments
            button.yt-sort-btn
                i.fas.fa-sort-amount-down
                span Sort by

        //- 2. Input Area
        //- Visible only if following
        .comment-form-container#commentFormContainer(style="display:none")
            .yt-input-row
                img.yt-user-avatar#currentUserAvatar(src="https://via.placeholder.com/40" style="display:none")
                
                .yt-input-wrapper
                    form#artistCommentForm
                        textarea#commentInput.yt-input(placeholder="Add a comment..." rows="1")
                        
                        //- Actions (Cancel / Comment)
                        .yt-actions-row#commentActions
                            button.btn-yt-cancel#cancelCommentBtn(type="button") Cancel
                            button.btn-yt-submit#submitCommentBtn(type="submit" disabled) Comment

        //- Prompt for non-followers
        #followToCommentPrompt(style="display: none; margin-bottom:30px;")
            .yt-follow-prompt
                i.fas.fa-lock
                span Only followers can comment.
                button.btn-action-sm.primary(onclick="document.getElementById('followBtn').click()") Follow

        //- 3. Comments Feed
        .comments-container#commentsContainer
            .comments-list#commentsList
                //- JS Populates this
            
            .comments-loading#commentsLoading(style="display: none;")
                i.fas.fa-spinner.fa-spin
                p Loading...

    div(style="height: 120px")
